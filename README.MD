---
#### Запуск программы
После запуска программы на выполнение JVM запускает загрузчики классов в которых запрашивается классы 
необходимые для выполнения данного , такие как JvmComprehension, Object, Integer, System и системные классы 
необходимые для исполнения команд JVM.

Загрузчик Bootstrap Classloader и Platform Classloader помещают системные классы  в Metaspace.
Загрузчик Application Classloader находят класс JvmComprehension и помещают его в Metaspace.

![alt-текст](https://imageup.ru/img102/3937743/1.png "Рисунок 1")

#### JVM начинает выполнение кода с метода main.
В Stack Memory помещается фрейм вызванный методом main. 

#### Строка 1 - int i = 1;
Далее в строке 1 переменная i помещается в созданный фрейм. 
[![imageup.ru](https://imageup.ru/img39/3937768/2.png)](https://imageup.ru/img39/3937768/2.png.html)

#### Строка 2 - Object o = new Object();
В Строке 2 в куче создается новый объект Object. 
В стеке создается переменная "o" которой присваивается ссылка на созданный объект в куче.
[![imageup.ru](https://imageup.ru/img26/3937770/3.png)](https://imageup.ru/img26/3937770/3.png.html)

#### Строка 3 - Integer ii = 2;
В Строке 3 в куче создается новый объект Integer в котором будет храниться значение переменной value равное 2. В стеке создается переменная ii которой присваивается ссылка 
на созданный в куче объект Integer.  
[![imageup.ru](https://imageup.ru/img202/3937779/4.png)](https://imageup.ru/img202/3937779/4.png.html)

#### Строка 4 - printAll(o, i, ii);
В Строке 4 создается новый фрейм в Stack Memory для метода printAll.
В этот фрейм помещаются переменные-параметры метода o, i, ii.
Затем в переменную o копируется ссылка на переданный в метод ссылка на объект Object.
Переменной переменной ii копируется ссылка на переданную в метод ссылку на объект Integer.
А переменной i присваивается значение переданное в метод равный 1.
[![imageup.ru](https://imageup.ru/img42/3937787/5.png)](https://imageup.ru/img42/3937787/5.png.html)

#### Строка 5 - Integer uselessVar = 700;
В строке 5 создается новый объект Integer в куче. У данного объекта будет хранится значение value равное 700.
В фрейме метода printAll создается переменная uselessVar 
которой присваивается ссылка на созданный в куче объект Integer.
[![imageup.ru](https://imageup.ru/img281/3937789/6.png)](https://imageup.ru/img281/3937789/6.png.html)

#### Строка 6 - System.out.println(o.toString() + i + ii);
В строке 6 создается новый фрейм в Stack Memory для метода println. 
В куче создается объект String с пустым значением.
Во фрейме println создается переменная x, которой присваивается ссылка на объект String.
[![imageup.ru](https://imageup.ru/img79/3937799/7.png)](https://imageup.ru/img79/3937799/7.png.html)

Далее у объекта o вызывается метод toString. Для него создается фрейм.
[![imageup.ru](https://imageup.ru/img29/3938242/8.png)](https://imageup.ru/img29/3938242/8.png.html)

Мотод выполняется, результатом работы метода будет строковое представление объекта o, 
которое помещается в объект строку в куче на которую указывает переменная x.
После выполнения метода фрейм toString уничтожается.
[![imageup.ru](https://imageup.ru/img52/3938248/9.png)](https://imageup.ru/img52/3938248/9.png.html)

Далее выполняется приведение типов переменной i и ii к строке и конкатенация.
Для этого JVM использует объект StringBuilder, 
который создается в куче. В стеке создается переменная, которой присваивается ссылка на созданный объект StringBuilder.
[![imageup.ru](https://imageup.ru/img196/3938283/10.png)](https://imageup.ru/img196/3938283/10.png.html)

Происходит конвертация переменной i в String. 
На этом этапе в хипе создается новая строка куда помещается строковое знаение переменной i.
Далее у объекта StringBuilder вызывается метод append для объединения строк. 
При этом создается оба раза создается новый фрейм метода append. 
Во фрейме создается переменная в которую копируется ссылка на конкатинируемый объект. 
И далее этот метод выполняется и результат записывается во внутреннее поле value Объекта StringBuilder 
и возвращается объект StringBuilder.
[![imageup.ru](https://imageup.ru/img216/3938292/11.png)](https://imageup.ru/img216/3938292/11.png.html)


После выполнения конкатенации происходит уничтожение фрейма и соответственно ссылки на строку.
[![imageup.ru](https://imageup.ru/img227/3938296/12.png)](https://imageup.ru/img227/3938296/12.png.html)

Далее выполняется метод toString объекта Integer на который ссылается переменная ii. 
Для этого в стеке создается фрейм метода toString. 
В результате данного метода в куче образуется новый объект String.
[![imageup.ru](https://imageup.ru/img153/3938301/13.png)](https://imageup.ru/img153/3938301/13.png.html)

После чего удаляется фрейм метода toString.
[![imageup.ru](https://imageup.ru/img237/3938303/14.png)](https://imageup.ru/img237/3938303/14.png.html)

Далее в стек снова помещается фрейм метода append, который производит конкатинацию 
строк и возвращает измененный объект StringBuilder.
Так же в фрейм помещается переменная str в которую копируется ссылка на объект String в куче, 
который мы будем объединять с текущим значением строки в StringBuilder.
[![imageup.ru](https://imageup.ru/img201/3938305/15.png)](https://imageup.ru/img201/3938305/15.png.html)

После этого фркйм метода append уничтожается.
[![imageup.ru](https://imageup.ru/img109/3938307/16.png)](https://imageup.ru/img109/3938307/16.png.html)

Далее вызывается метод toString у объекта StringBuilder. В стеке образуется новый фрейм.
[![imageup.ru](https://imageup.ru/img86/3938313/17.png)](https://imageup.ru/img86/3938313/17.png.html)

После выполнения данного метода в куче образуется новая строка, а фреим toString уничтожается. 
Уничтожается переменная в фрейме println и ссылка на StringBuilder.
Объект String на который ссылается переменная x обновляется.
[![imageup.ru](https://imageup.ru/img73/3938319/18.png)](https://imageup.ru/img73/3938319/18.png.html)

Выполняется метод println. На консоль выводится значение строки на которую ссылается переменная x.
Далее фрейм println уничтожается вместе со ссылками.
[![imageup.ru](https://imageup.ru/img147/3938323/19.png)](https://imageup.ru/img147/3938323/19.png.html)

Далее продолжается выполнение метода printAll, в котором нет больше команд. 
Соответственно фрейм printAll уничтожается вместе со всемы ссылками входящими в него.
[![imageup.ru](https://imageup.ru/img138/3938332/20.png)](https://imageup.ru/img138/3938332/20.png.html)

#### Строка 7 - System.out.println("finished");
Управление возвращается в метод main. Далее вызывается метод println. 
В стек помещается новый фрейм. Во фрейм помещается переменная x в которую копируется ссылка на объект String, 
который должен выводиться на консоль.
[![imageup.ru](https://imageup.ru/img195/3938336/21.png)](https://imageup.ru/img195/3938336/21.png.html)

Далее на консоль выводится строка "finish".
Фрейм println вместе со ссылка уничтожается. Управление передается в метод main.
[![imageup.ru](https://imageup.ru/img155/3938338/22.png)](https://imageup.ru/img155/3938338/22.png.html)

Далее т.к. все методы в main выполнены уничтожается фрейм метода мейн со всемы ссылками.
[![imageup.ru](https://imageup.ru/img125/3938341/23.png)](https://imageup.ru/img125/3938341/23.png.html)

Далее программа завершается а память занимаемая процессом Java освобождается.

---
Отдельно о сборщике мусора. Сборщик мусора начинает работать не зависимо от команд, 
он имеет сложный механизм оценки необходимости очищения кучи, 
в нашем случае может произойти на любом из этапов выполнения или же не выполнится никогда.




